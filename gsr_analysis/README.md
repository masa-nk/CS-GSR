# GSR（射撃残渣）の採取方法比較・分析システム (ユーザーデータ対応版)

## 1. 概要

本システムは、**お手持ちのGSR（無機性射撃残渣）データ**を用いて、2つの異なる採取方法（または異なる条件）で得られた粒子データを比較・評価するための分析パイプラインです。

分析手法として、以下の2つを実装しています。

1.  **主成分分析 (PCA)**: 10次元以上（可変）の元素組成データを、特徴を保持したまま人間が解釈しやすい3次元空間に削減し、2つのデータセットがどのように分布しているかを可視化します。
2.  **ランダムフォレスト**: 機械学習の分類モデルを用い、2つのデータセットをどの程度正確に分類できるかを測定します。この分類精度が、データセット間の「類似性」あるいは「差異」の客観的な指標となります。

## 2. プロジェクト構成

```
gsr_analysis/
│
├── user_data/              # ★★★ あなたのデータファイルをここに配置します ★★★
│   ├── method_A_1.csv
│   ├── method_A_2.csv
│   │   ...
│   ├── method_B_1.csv
│   └── ...
│
├── pca_plot.png            # (出力) PCAによる3D散布図
├── confusion_matrix.png    # (出力) ランダムフォレストの混同行列
│
├── pca_analysis.py         # 主成分分析を実行するスクリプト
├── similarity_analysis.py  # ランダムフォレストで類似性を評価するスクリプト
├── utils.py                # データ読み込み用の共通スクリプト
├── main.py                 # 全ての分析処理を統括するメインスクリプト
└── README.md               # このファイル
```

## 3. 実行方法

### ステップ1: 実行環境のセットアップ

本システムはPython 3を使用します。初回のみ、必要なライブラリをインストールしてください。

```bash
pip install pandas numpy scikit-learn matplotlib seaborn
```

### ステップ2: データファイルの準備と配置

1.  `gsr_analysis` フォルダ内に `user_data` という名前のフォルダがあることを確認します（なければ作成してください）。
2.  あなたのGSRデータ（CSV形式）を、この `user_data` フォルダに配置します。

**【重要】ファイル名のルール**

ファイル名は、以下の命名規則に従ってください。
-   比較したい一方のグループ（例: 既存の採取方法）のファイルは `method_A_` で始める。
    -   例: `method_A_sample1.csv`, `method_A_002.csv`, `method_A_test.csv`
-   もう一方のグループ（例: 新しい採取方法）のファイルは `method_B_` で始める。
    -   例: `method_B_sample1.csv`, `method_B_001.csv`, `method_B_test.csv`

※ CSVファイルの1行目は、元素名などのヘッダー行である必要があります。

### ステップ3: 分析の実行

`gsr_analysis` ディレクトリに移動し、以下のコマンドで `main.py` を実行します。

```bash
python main.py
```

実行すると、`user_data` フォルダ内のすべての対象ファイルが自動的に読み込まれ、分析が開始されます。完了後、`gsr_analysis` フォルダ内に `pca_plot.png` と `confusion_matrix.png` が出力されます。

## 4. 分析結果の解釈

### a. 主成分分析 (PCA) の結果 (`pca_plot.png`)

-   この3D散布図は、あなたのデータの特徴を最もよく表現する3つの軸（主成分）でプロットしたものです。
-   **2つのデータ群（青: Method A, 赤: Method B）が明確に分離されている場合**: 2つの方法で得られたGSRの組成プロファイルには、統計的に顕著な差があることを示唆します。
-   **2つのデータ群が大きく重なり合っている場合**: 2つの方法による差は小さい（類似性が高い）ことを示唆します。

### b. ランダムフォレストによる類似性評価の結果 (コンソール出力 & `confusion_matrix.png`)

-   **Accuracy (正解率)**: 2つのデータセットの粒子が、どちらの方法に由来するかをモデルがどれだけ正確に当てられたかを示します。
    -   **100%に近い場合**: 2つのデータセットは非常に異なっており、ほぼ完璧に区別できます（類似性が低い）。
    -   **50%に近い場合**: モデルはランダムに当てるのと同程度の性能しかなく、2つのデータセットは非常によく似ていることを意味します（類似性が高い）。
-   **Confusion Matrix (混同行列)**: モデルが「どのラベルをどのラベルに間違えたか」を視覚的に示します。対角線上に数字が集まるほど、分類がうまくいっていることを示します。

### 総合的な考察

PCAによる可視化と、ランダムフォレストによる定量的評価を組み合わせることで、2つの採取方法（あるいは測定条件）の間の「差」や「類似性」を多角的に評価できます。これにより、例えば「新しい手法は、既存の手法と比べて同等の結果を出せているか？」といった問いに、客観的な根拠を持って答えることが可能になります。
