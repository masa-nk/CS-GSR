# GSR（射撃残渣）の採取方法比較・分析システム

## 1. 概要

本システムは、2つの異なる採取方法によって得られたGSR（無機性射撃残渣）の粒子データを比較・評価するための分析パイプラインです。

GSRのデータは、通常、多数の粒子に含まれる元素の組成比として得られます。このシステムでは、まずWeb調査に基づいた10種類の元素（Pb, Ba, Sbなど）から成る仮想的なGSRデータを2種類（採取方法A, 採取方法B）生成します。

その後、以下の2つの手法を用いて、生成されたデータセットを分析・比較します。

1.  **主成分分析 (PCA)**: 10次元の元素組成データを人間が解釈しやすい3次元空間に削減し、2つのデータセットがどのように分布しているかを可視化します。
2.  **ランダムフォレスト**: 機械学習の分類モデルであるランダムフォレストを用いて、2つのデータセットをどの程度正確に分類できるかを測定します。この分類精度が、データセット間の「類似性」あるいは「差異」の指標となります。

## 2. プロジェクト構成

```
gsr_analysis/
│
├── method_A.csv            # (出力) 採取方法Aの仮想データ
├── method_B.csv            # (出力) 採取方法Bの仮想データ
├── pca_plot.png            # (出力) PCAによる3D散布図
├── confusion_matrix.png    # (出力) ランダムフォレストの混同行列
│
├── generate_data.py        # 仮想データを生成するスクリプト
├── pca_analysis.py         # 主成分分析を行い、結果をプロットするスクリプト
├── similarity_analysis.py  # ランダムフォレストで類似性を評価するスクリプト
├── main.py                 # 全ての分析処理を統括するメインスクリプト
└── README.md               # このファイル
```

## 3. 実行環境のセットアップ

本システムはPython 3を使用します。必要なライブラリは以下の通りです。

-   pandas
-   numpy
-   scikit-learn
-   matplotlib
-   seaborn

これらのライブラリは、`pip` を使ってインストールできます。

```bash
pip install pandas numpy scikit-learn matplotlib seaborn
```

## 4. 実行方法

`gsr_analysis` ディレクトリに移動し、以下のコマンドで `main.py` を実行するだけです。

```bash
python main.py
```

実行すると、以下の処理が自動的に行われます。
1.  `method_A.csv` と `method_B.csv` が生成されます。
2.  `pca_analysis.py` が実行され、`pca_plot.png` が生成されます。
3.  `similarity_analysis.py` が実行され、コンソールに分類結果が出力され、`confusion_matrix.png` が生成されます。

## 5. 分析結果の解釈

### a. 主成分分析 (PCA) の結果 (`pca_plot.png`)

-   この3D散布図は、10次元のデータを最もよく表現する3つの主成分を軸としてプロットしたものです。
-   **2つのデータ群（青: Method A, 赤: Method B）が明確に分離されている場合**: 2つの採取方法で得られたGSRの組成プロファイルには、統計的に顕著な差があることを示唆します。
-   **2つのデータ群が大きく重なり合っている場合**: 2つの採取方法による差は小さい（類似性が高い）ことを示唆します。
-   今回の仮想データでは、2つの群は一部重なりつつも、分布の中心がずれている様子が確認できるはずです。これは、採取方法BがAに比べて特定の元素の検出効率が悪い、という設定を反映しています。

### b. ランダムフォレストによる類似性評価の結果 (コンソール出力 & `confusion_matrix.png`)

-   **Accuracy (正解率)**: 2つのデータセットの粒子が、どちらの採取方法に由来するかを、モデルがどれだけ正確に当てられたかを示します。
    -   **100%に近い場合**: 2つのデータセットは非常に異なっており、ほぼ完璧に区別できます（類似性が低い）。
    -   **50%に近い場合**: モデルはランダムに当てるのと同程度の性能しかなく、2つのデータセットは非常によく似ている（区別がつかない）ことを意味します（類似性が高い）。
-   **Classification Report**: `precision` (適合率), `recall` (再現率), `f1-score` といった、より詳細な評価指標を提供します。
-   **Confusion Matrix (混同行列)**: モデルがどのように間違えたかを視覚的に示します。例えば、「実際はAなのにBと予測された」サンプルの数がわかります。対角線上に数字が集まっているほど、分類がうまくいっていることを示します。

### 総合的な考察

PCAによる可視化と、ランダムフォレストによる定量的評価を組み合わせることで、2つの採取方法の間の「差」を多角的に評価できます。正解率が約80%という結果は、「2つの方法は異なる傾向を持つが、一部の粒子はどちらの方法でも同じように採取されうる」という、現実的なシナリオを示唆しています。この分析手法は、新しい採取方法が既存の方法と比べてどの程度同等の結果を出せるかを評価するのに役立ちます。
